[INFO] All services are starting up...
[INFO] Step 4: Waiting for all services to become healthy...
Waiting for PostgreSQL to be ready (will timeout after 60 seconds)...

PostgreSQL is ready. âœ“
Waiting for Redis to be ready (will timeout after 60 seconds)...

Redis is ready. âœ“
Waiting for Kafka to be ready (will timeout after 90 seconds)...

Kafka is ready. âœ“
[INFO] Step 5: Loading data from country-code.csv...
2025-07-23 15:00:15,024 - INFO - ğŸ“Š Progress: 1000/10000 cities processed...
2025-07-23 15:00:15,646 - INFO - ğŸ“Š Progress: 2000/10000 cities processed...
2025-07-23 15:00:16,178 - INFO - ğŸ“Š Progress: 3000/10000 cities processed...
2025-07-23 15:00:16,703 - INFO - ğŸ“Š Progress: 4000/10000 cities processed...
2025-07-23 15:00:17,248 - INFO - ğŸ“Š Progress: 5000/10000 cities processed...
2025-07-23 15:00:17,785 - INFO - ğŸ“Š Progress: 6000/10000 cities processed...
2025-07-23 15:00:18,316 - INFO - ğŸ“Š Progress: 7000/10000 cities processed...
2025-07-23 15:00:18,844 - INFO - ğŸ“Š Progress: 8000/10000 cities processed...
2025-07-23 15:00:19,375 - INFO - ğŸ“Š Progress: 9000/10000 cities processed...
2025-07-23 15:00:19,903 - INFO - ğŸ“Š Progress: 10000/10000 cities processed...
2025-07-23 15:00:19,903 - INFO - ğŸ‰ CSV data loading completed!
2025-07-23 15:00:19,903 - INFO - ğŸ“Š Final Statistics:
2025-07-23 15:00:19,903 - INFO -    - Total rows in CSV: 10000
2025-07-23 15:00:19,903 - INFO -    - Cities created   : 678
2025-07-23 15:00:19,903 - INFO -    - Cities updated   : 9275
2025-07-23 15:00:19,903 - INFO -    - Rows skipped     : 47
2025-07-23 15:00:19,903 - INFO -    - Errors           : 0
2025-07-23 15:00:19,903 - INFO -    - Processing time  : 5.96s
[INFO] Data loaded successfully âœ“
[INFO] Step 6: Waiting for the City Service API to be healthy...

City Service API is healthy and running. âœ“
[INFO] Step 7: Running automated API tests inside the container...
â³ Waiting 2 seconds for API to be ready...

============================================================
 Starting City Service API Tests
============================================================

============================================================
 Testing Health Endpoint
============================================================
âœ… Health check passed - Status: healthy
âœ… Database is healthy
âœ… Redis is healthy
âœ… Kafka is healthy

============================================================
 Testing CRUD Operations
============================================================
âŒ Failed to create city Tokyo: 307
âŒ Failed to create city London: 307
âŒ Failed to create city New York City: 307
âŒ Failed to create city Paris: 307
âŒ Failed to create city Berlin: 307
âŒ Failed to get country code for Tokyo: 404
âŒ Failed to get country code for London: 404
âŒ Failed to get country code for New York City: 404
âŒ Failed to get country code for Paris: 404
âŒ Failed to get country code for Berlin: 404
âŒ Failed to list cities: 307
âŒ Failed to get metrics: 404

============================================================
 Testing Cache Performance
============================================================
â„¹ï¸  Testing cache miss performance...
âŒ Cache miss request failed: 404
â„¹ï¸  Testing cache hit performance...
âŒ Cache hit request failed: 404
â„¹ï¸  Cache performance difference: 19.3% (hit might be slower due to network variance)
â„¹ï¸  Cache miss time: 10.40ms
â„¹ï¸  Cache hit time: 12.88ms

============================================================
 Testing Error Handling
============================================================
âœ… 404 error handling works correctly
âŒ Expected 422, got 307

============================================================
 Testing Concurrent Requests
============================================================
âŒ Failed to get country code for London: request failed
âŒ Failed to get country code for Paris: request failed
âŒ Failed to get country code for Rome: request failed
âŒ Failed to get country code for Madrid: request failed
âŒ Failed to get country code for Berlin: request failed
âœ… Concurrent requests completed: 0/5
â„¹ï¸  Total time: 112.62ms
â„¹ï¸  Average time per request: 22.52ms
âŒ Failed to delete city Tokyo: 404

============================================================
 Test Summary
============================================================
âŒ Tests passed: 6/27 (22.2%)
âŒ Tests failed: 22

âš ï¸  Some tests failed. Check the logs above for details.
[ERROR] API tests failed. Please check the output above for errors.
