2025-07-23 13:51:34,356 - WARNING - Integrity error for city 'Ä°zmir': (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_cities_name"
DETAIL:  Key (name)=(Ä°zmir) already exists.
[SQL: INSERT INTO cities (name, country_code) VALUES ($1::VARCHAR, $2::VARCHAR) RETURNING cities.id, cities.created_at, cities.updated_at]
[parameters: ('Ä°zmir', 'SA')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-23 13:51:34,502 - INFO - ğŸ“Š Progress: 3000/10000 cities processed...
2025-07-23 13:51:34,552 - WARNING - Integrity error for city 'Ä°zmir': (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_cities_name"
DETAIL:  Key (name)=(Ä°zmir) already exists.
[SQL: INSERT INTO cities (name, country_code) VALUES ($1::VARCHAR, $2::VARCHAR) RETURNING cities.id, cities.created_at, cities.updated_at]
[parameters: ('Ä°zmir', 'SI')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-23 13:51:34,636 - WARNING - Integrity error for city 'Ä°zmir': (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_cities_name"
DETAIL:  Key (name)=(Ä°zmir) already exists.
[SQL: INSERT INTO cities (name, country_code) VALUES ($1::VARCHAR, $2::VARCHAR) RETURNING cities.id, cities.created_at, cities.updated_at]
[parameters: ('Ä°zmir', 'GY')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-23 13:51:34,720 - WARNING - Integrity error for city 'Ä°zmir': (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_cities_name"
DETAIL:  Key (name)=(Ä°zmir) already exists.
[SQL: INSERT INTO cities (name, country_code) VALUES ($1::VARCHAR, $2::VARCHAR) RETURNING cities.id, cities.created_at, cities.updated_at]
[parameters: ('Ä°zmir', 'NZ')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-23 13:51:34,979 - INFO - ğŸ“Š Progress: 4000/10000 cities processed...
2025-07-23 13:51:35,374 - WARNING - Integrity error for city 'Ä°zmir': (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_cities_name"
DETAIL:  Key (name)=(Ä°zmir) already exists.
[SQL: INSERT INTO cities (name, country_code) VALUES ($1::VARCHAR, $2::VARCHAR) RETURNING cities.id, cities.created_at, cities.updated_at]
[parameters: ('Ä°zmir', 'YE')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-23 13:51:35,453 - INFO - ğŸ“Š Progress: 5000/10000 cities processed...
2025-07-23 13:51:35,458 - WARNING - Integrity error for city 'Ä°zmir': (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_cities_name"
DETAIL:  Key (name)=(Ä°zmir) already exists.
[SQL: INSERT INTO cities (name, country_code) VALUES ($1::VARCHAR, $2::VARCHAR) RETURNING cities.id, cities.created_at, cities.updated_at]
[parameters: ('Ä°zmir', 'BT')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-23 13:51:35,751 - WARNING - Integrity error for city 'Ä°zmir': (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_cities_name"
DETAIL:  Key (name)=(Ä°zmir) already exists.
[SQL: INSERT INTO cities (name, country_code) VALUES ($1::VARCHAR, $2::VARCHAR) RETURNING cities.id, cities.created_at, cities.updated_at]
[parameters: ('Ä°zmir', 'GS')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-23 13:51:35,935 - INFO - ğŸ“Š Progress: 6000/10000 cities processed...
2025-07-23 13:51:36,049 - WARNING - Integrity error for city 'Ä°zmir': (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_cities_name"
DETAIL:  Key (name)=(Ä°zmir) already exists.
[SQL: INSERT INTO cities (name, country_code) VALUES ($1::VARCHAR, $2::VARCHAR) RETURNING cities.id, cities.created_at, cities.updated_at]
[parameters: ('Ä°zmir', 'RE')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-23 13:51:36,300 - WARNING - Integrity error for city 'Ä°zmir': (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_cities_name"
DETAIL:  Key (name)=(Ä°zmir) already exists.
[SQL: INSERT INTO cities (name, country_code) VALUES ($1::VARCHAR, $2::VARCHAR) RETURNING cities.id, cities.created_at, cities.updated_at]
[parameters: ('Ä°zmir', 'GF')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-23 13:51:36,405 - INFO - ğŸ“Š Progress: 7000/10000 cities processed...
2025-07-23 13:51:36,563 - WARNING - Integrity error for city 'Ä°zmir': (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_cities_name"
DETAIL:  Key (name)=(Ä°zmir) already exists.
[SQL: INSERT INTO cities (name, country_code) VALUES ($1::VARCHAR, $2::VARCHAR) RETURNING cities.id, cities.created_at, cities.updated_at]
[parameters: ('Ä°zmir', 'HN')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-23 13:51:36,590 - WARNING - Integrity error for city 'Ä°zmir': (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_cities_name"
DETAIL:  Key (name)=(Ä°zmir) already exists.
[SQL: INSERT INTO cities (name, country_code) VALUES ($1::VARCHAR, $2::VARCHAR) RETURNING cities.id, cities.created_at, cities.updated_at]
[parameters: ('Ä°zmir', 'BY')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-23 13:51:36,640 - WARNING - Integrity error for city 'Ä°zmir': (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_cities_name"
DETAIL:  Key (name)=(Ä°zmir) already exists.
[SQL: INSERT INTO cities (name, country_code) VALUES ($1::VARCHAR, $2::VARCHAR) RETURNING cities.id, cities.created_at, cities.updated_at]
[parameters: ('Ä°zmir', 'IT')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-23 13:51:36,645 - WARNING - Integrity error for city 'Ä°zmir': (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_cities_name"
DETAIL:  Key (name)=(Ä°zmir) already exists.
[SQL: INSERT INTO cities (name, country_code) VALUES ($1::VARCHAR, $2::VARCHAR) RETURNING cities.id, cities.created_at, cities.updated_at]
[parameters: ('Ä°zmir', 'PT')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-23 13:51:36,722 - WARNING - Integrity error for city 'Ä°zmir': (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_cities_name"
DETAIL:  Key (name)=(Ä°zmir) already exists.
[SQL: INSERT INTO cities (name, country_code) VALUES ($1::VARCHAR, $2::VARCHAR) RETURNING cities.id, cities.created_at, cities.updated_at]
[parameters: ('Ä°zmir', 'PH')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-23 13:51:36,882 - INFO - ğŸ“Š Progress: 8000/10000 cities processed...
2025-07-23 13:51:36,992 - WARNING - Integrity error for city 'Ä°zmir': (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_cities_name"
DETAIL:  Key (name)=(Ä°zmir) already exists.
[SQL: INSERT INTO cities (name, country_code) VALUES ($1::VARCHAR, $2::VARCHAR) RETURNING cities.id, cities.created_at, cities.updated_at]
[parameters: ('Ä°zmir', 'KW')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-23 13:51:37,007 - WARNING - Integrity error for city 'Ä°zmir': (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_cities_name"
DETAIL:  Key (name)=(Ä°zmir) already exists.
[SQL: INSERT INTO cities (name, country_code) VALUES ($1::VARCHAR, $2::VARCHAR) RETURNING cities.id, cities.created_at, cities.updated_at]
[parameters: ('Ä°zmir', 'GT')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-23 13:51:37,266 - WARNING - Integrity error for city 'Ä°zmir': (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_cities_name"
DETAIL:  Key (name)=(Ä°zmir) already exists.
[SQL: INSERT INTO cities (name, country_code) VALUES ($1::VARCHAR, $2::VARCHAR) RETURNING cities.id, cities.created_at, cities.updated_at]
[parameters: ('Ä°zmir', 'BA')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-23 13:51:37,355 - INFO - ğŸ“Š Progress: 9000/10000 cities processed...
2025-07-23 13:51:37,576 - WARNING - Integrity error for city 'Ä°zmir': (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_cities_name"
DETAIL:  Key (name)=(Ä°zmir) already exists.
[SQL: INSERT INTO cities (name, country_code) VALUES ($1::VARCHAR, $2::VARCHAR) RETURNING cities.id, cities.created_at, cities.updated_at]
[parameters: ('Ä°zmir', 'CA')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-23 13:51:37,829 - INFO - ğŸ‰ CSV data loading completed!
2025-07-23 13:51:37,829 - INFO - ğŸ“Š Final Statistics:
2025-07-23 13:51:37,829 - INFO -    - Total rows in CSV: 10000
2025-07-23 13:51:37,829 - INFO -    - Successfully processed: 10000
2025-07-23 13:51:37,829 - INFO -    - Cities created: 660
2025-07-23 13:51:37,829 - INFO -    - Cities updated: 9275
2025-07-23 13:51:37,829 - INFO -    - Rows skipped: 47
2025-07-23 13:51:37,829 - INFO -    - Processing time: 4.90s
2025-07-23 13:51:37,829 - WARNING - âš ï¸  18 errors occurred during processing
2025-07-23 13:51:37,829 - WARNING -    - Showing first 5 errors:
2025-07-23 13:51:37,829 - WARNING -    - Row 2686: Ä°zmir - Integrity error: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_cities_name"
DETAIL:  Key (name)=(Ä°zmir) already exists.
[SQL: INSERT INTO cities (name, country_code) VALUES ($1::VARCHAR, $2::VARCHAR) RETURNING cities.id, cities.created_at, cities.updated_at]
[parameters: ('Ä°zmir', 'SA')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-23 13:51:37,829 - WARNING -    - Row 3108: Ä°zmir - Integrity error: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_cities_name"
DETAIL:  Key (name)=(Ä°zmir) already exists.
[SQL: INSERT INTO cities (name, country_code) VALUES ($1::VARCHAR, $2::VARCHAR) RETURNING cities.id, cities.created_at, cities.updated_at]
[parameters: ('Ä°zmir', 'SI')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-23 13:51:37,829 - WARNING -    - Row 3286: Ä°zmir - Integrity error: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_cities_name"
DETAIL:  Key (name)=(Ä°zmir) already exists.
[SQL: INSERT INTO cities (name, country_code) VALUES ($1::VARCHAR, $2::VARCHAR) RETURNING cities.id, cities.created_at, cities.updated_at]
[parameters: ('Ä°zmir', 'GY')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-23 13:51:37,829 - WARNING -    - Row 3462: Ä°zmir - Integrity error: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_cities_name"
DETAIL:  Key (name)=(Ä°zmir) already exists.
[SQL: INSERT INTO cities (name, country_code) VALUES ($1::VARCHAR, $2::VARCHAR) RETURNING cities.id, cities.created_at, cities.updated_at]
[parameters: ('Ä°zmir', 'NZ')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-23 13:51:37,829 - WARNING -    - Row 4833: Ä°zmir - Integrity error: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "ix_cities_name"
DETAIL:  Key (name)=(Ä°zmir) already exists.
[SQL: INSERT INTO cities (name, country_code) VALUES ($1::VARCHAR, $2::VARCHAR) RETURNING cities.id, cities.created_at, cities.updated_at]
[parameters: ('Ä°zmir', 'YE')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-07-23 13:51:37,829 - WARNING -    - ... and 13 more
2025-07-23 13:51:37,829 - WARNING - âš ï¸  Data loading completed with errors
[INFO] âœ“ CSV data loaded successfully
[STEP] ğŸ§ª Running comprehensive API tests...
[INFO] Executing test suite inside container...
â³ Waiting 2 seconds for API to be ready...

============================================================
 Starting City Service API Tests
============================================================

============================================================
 Testing Health Endpoint
============================================================
âœ… Health check passed - Status: healthy
âœ… Database is healthy
âœ… Redis is healthy
âœ… Kafka is healthy

============================================================
 Testing CRUD Operations
============================================================
âŒ Failed to create city Tokyo: 307
âŒ Failed to create city London: 307
âŒ Failed to create city New York: 307
âŒ Failed to create city Paris: 307
âŒ Failed to create city Berlin: 307
âŒ Failed to get country code for Tokyo: 404
âŒ Failed to get country code for London: 404
âŒ Failed to get country code for New York: 404
âŒ Failed to get country code for Paris: 404
âŒ Failed to get country code for Berlin: 404
âŒ Failed to list cities: 307
âŒ Failed to get metrics: 404

============================================================
 Testing Cache Performance
============================================================
â„¹ï¸  Testing cache miss performance...
âŒ Cache miss request failed: 404
â„¹ï¸  Testing cache hit performance...
âŒ Cache hit request failed: 404
â„¹ï¸  Cache performance difference: 21.6% (hit might be slower due to network variance)
â„¹ï¸  Cache miss time: 10.55ms
â„¹ï¸  Cache hit time: 13.45ms

============================================================
 Testing Error Handling
============================================================
âœ… 404 error handling works correctly
âŒ Expected 422, got 307

============================================================
 Testing Concurrent Requests
============================================================
âŒ Failed to get country code for Paris: request failed
âŒ Failed to get country code for London: request failed
âŒ Failed to get country code for Rome: request failed
âŒ Failed to get country code for Madrid: request failed
âŒ Failed to get country code for Berlin: request failed
âœ… Concurrent requests completed: 0/5
â„¹ï¸  Total time: 112.15ms
â„¹ï¸  Average time per request: 22.43ms
âŒ Failed to delete city Tokyo: 404

============================================================
 Test Summary
============================================================
âŒ Tests passed: 6/27 (22.2%)
âŒ Tests failed: 22
