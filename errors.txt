[INFO] All services are starting up...
[INFO] Step 4: Waiting for all services to become healthy...
Waiting for PostgreSQL to be ready (will timeout after 60 seconds)...

PostgreSQL is ready. ✓
Waiting for Redis to be ready (will timeout after 60 seconds)...

Redis is ready. ✓
Waiting for Kafka to be ready (will timeout after 90 seconds)...

Kafka is ready. ✓
[INFO] Step 5: Loading data from country-code.csv...
2025-07-23 15:00:15,024 - INFO - 📊 Progress: 1000/10000 cities processed...
2025-07-23 15:00:15,646 - INFO - 📊 Progress: 2000/10000 cities processed...
2025-07-23 15:00:16,178 - INFO - 📊 Progress: 3000/10000 cities processed...
2025-07-23 15:00:16,703 - INFO - 📊 Progress: 4000/10000 cities processed...
2025-07-23 15:00:17,248 - INFO - 📊 Progress: 5000/10000 cities processed...
2025-07-23 15:00:17,785 - INFO - 📊 Progress: 6000/10000 cities processed...
2025-07-23 15:00:18,316 - INFO - 📊 Progress: 7000/10000 cities processed...
2025-07-23 15:00:18,844 - INFO - 📊 Progress: 8000/10000 cities processed...
2025-07-23 15:00:19,375 - INFO - 📊 Progress: 9000/10000 cities processed...
2025-07-23 15:00:19,903 - INFO - 📊 Progress: 10000/10000 cities processed...
2025-07-23 15:00:19,903 - INFO - 🎉 CSV data loading completed!
2025-07-23 15:00:19,903 - INFO - 📊 Final Statistics:
2025-07-23 15:00:19,903 - INFO -    - Total rows in CSV: 10000
2025-07-23 15:00:19,903 - INFO -    - Cities created   : 678
2025-07-23 15:00:19,903 - INFO -    - Cities updated   : 9275
2025-07-23 15:00:19,903 - INFO -    - Rows skipped     : 47
2025-07-23 15:00:19,903 - INFO -    - Errors           : 0
2025-07-23 15:00:19,903 - INFO -    - Processing time  : 5.96s
[INFO] Data loaded successfully ✓
[INFO] Step 6: Waiting for the City Service API to be healthy...

City Service API is healthy and running. ✓
[INFO] Step 7: Running automated API tests inside the container...
⏳ Waiting 2 seconds for API to be ready...

============================================================
 Starting City Service API Tests
============================================================

============================================================
 Testing Health Endpoint
============================================================
✅ Health check passed - Status: healthy
✅ Database is healthy
✅ Redis is healthy
✅ Kafka is healthy

============================================================
 Testing CRUD Operations
============================================================
❌ Failed to create city Tokyo: 307
❌ Failed to create city London: 307
❌ Failed to create city New York City: 307
❌ Failed to create city Paris: 307
❌ Failed to create city Berlin: 307
❌ Failed to get country code for Tokyo: 404
❌ Failed to get country code for London: 404
❌ Failed to get country code for New York City: 404
❌ Failed to get country code for Paris: 404
❌ Failed to get country code for Berlin: 404
❌ Failed to list cities: 307
❌ Failed to get metrics: 404

============================================================
 Testing Cache Performance
============================================================
ℹ️  Testing cache miss performance...
❌ Cache miss request failed: 404
ℹ️  Testing cache hit performance...
❌ Cache hit request failed: 404
ℹ️  Cache performance difference: 19.3% (hit might be slower due to network variance)
ℹ️  Cache miss time: 10.40ms
ℹ️  Cache hit time: 12.88ms

============================================================
 Testing Error Handling
============================================================
✅ 404 error handling works correctly
❌ Expected 422, got 307

============================================================
 Testing Concurrent Requests
============================================================
❌ Failed to get country code for London: request failed
❌ Failed to get country code for Paris: request failed
❌ Failed to get country code for Rome: request failed
❌ Failed to get country code for Madrid: request failed
❌ Failed to get country code for Berlin: request failed
✅ Concurrent requests completed: 0/5
ℹ️  Total time: 112.62ms
ℹ️  Average time per request: 22.52ms
❌ Failed to delete city Tokyo: 404

============================================================
 Test Summary
============================================================
❌ Tests passed: 6/27 (22.2%)
❌ Tests failed: 22

⚠️  Some tests failed. Check the logs above for details.
[ERROR] API tests failed. Please check the output above for errors.
